5.2. Применение принципов IaaC в работе с виртуальными машинами

Задача 1

Опишите своими словами основные преимущества применения на практике IaaC паттернов.
Какой из принципов IaaC является основополагающим?

Преимуществом применения IaaC являтся автоматизация процесов разработки и развертывания, что приводит к значительному сокращению времени выхода приложения в коммерческое использование. IaaC подход обьясняет как правильно писать код, структурировать, документировать и т.д. В следствие чего IaaC помогает существенно сократить количество ошибок в конфигурации и проблем связанными с использованием различных сред для разработки, тестирования и развертывания. Самое главное преимущество применения IaaC это идемпотентность, то есть стабильное качество и результат работы кода раз за разом. Обеспечение идемпотентности является ключевым принципом IaaC.


Задача 2

Чем Ansible выгодно отличается от других систем управление конфигурациями?
Какой, на ваш взгляд, метод работы систем конфигурации более надёжный push или pull?

Ansible не требует установки клиента на целевую инфраструктуру все функции производятся по SSH. Также он прост в использовании по сравнению с другими системами управления конфигурациями. Легко расширяется за счет модулей. Написан на python. Для простых задач ansible может быть заущен из командной строки. 
Push, на мой взгляд, является более надёжным потому что в этом случае администратор контролирует сам многие процессы, такие как установка необходимых ресурсов на управляемый сервер  и на ПК, откуда передаются конфигурации. В режиме pull действия автоматизированы в большей степени и инициируются сервером, что может привести к непредскажуемым результатам и ошибкам. Также режим push не требует установки агентов, что также упрощает работу и повышает надежность.


Задача 3
Установить на личный компьютер:

VirtualBox
Vagrant
Ansible
Приложить вывод команд установленных версий каждой из программ, оформленный в markdown.

leolex@leolex-VirtualBox:~$ vboxmanage --version
6.1.32_Ubuntur149290

leolex@leolex-VirtualBox:~$ vagrant --version
Vagrant 2.2.6

leolex@leolex-VirtualBox:~$ ansible --version
ansible 2.9.6
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/leolex/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3/dist-packages/ansible
  executable location = /usr/bin/ansible
  python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0]


Задача 4 (*)
Воспроизвести практическую часть лекции самостоятельно.

Создать виртуальную машину.
Зайти внутрь ВМ, убедиться, что Docker установлен с помощью команды
docker ps

leolex@leolex-VirtualBox:~/.vagrant.d$ vagrant up
Bringing machine 'server1.netology' up with 'virtualbox' provider...
==> server1.netology: Importing base box 'bento/ubuntu-20.04'...
==> server1.netology: Matching MAC address for NAT networking...
==> server1.netology: Checking if box 'bento/ubuntu-20.04' version '202206.03.0' is up to date...
==> server1.netology: Setting the name of the VM: server1.netology
==> server1.netology: Clearing any previously set network interfaces...
==> server1.netology: Preparing network interfaces based on configuration...
    server1.netology: Adapter 1: nat
    server1.netology: Adapter 2: hostonly
==> server1.netology: Forwarding ports...
    server1.netology: 22 (guest) => 20011 (host) (adapter 1)
    server1.netology: 22 (guest) => 2222 (host) (adapter 1)
==> server1.netology: Running 'pre-boot' VM customizations...
==> server1.netology: Booting VM...
==> server1.netology: Waiting for machine to boot. This may take a few minutes...
    server1.netology: SSH address: 127.0.0.1:2222
    server1.netology: SSH username: vagrant
    server1.netology: SSH auth method: private key

Зависает на данном шаге. 

Timed out while waiting for the machine to boot. This means that
Vagrant was unable to communicate with the guest machine within
the configured ("config.vm.boot_timeout" value) time period.

If you look above, you should be able to see the error(s) that
Vagrant had when attempting to connect to the machine. These errors
are usually good hints as to what may be wrong.

If you're using a custom box, make sure that networking is properly
working and you're able to connect to the machine. It is a common
problem that networking isn't setup properly in these boxes.
Verify that authentication configurations are also setup properly,
as well.

If the box appears to be booting properly, you may want to increase
the timeout ("config.vm.boot_timeout") value.

Задача со звездочкой не получилась, по причине приведенной выше ошибки. Пытался гуглить в интернете, но решение не нашел.


*****************************************************************************************************

5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения.

Задача 1
Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

Ответ:

Паравиртуализация - ядро гостевой ОС модифицируется для работы с гипервизором. Гостевой ОС известно, что она гостевая система и есть хостовая ОС, куда передаются соответствующие команды. То есть Каждой виртуальной машине выделяется ровно столько ресурсов, сколько определено гипервизором, который является неким посредником между аппаратной частью и гостевой ОС.

Аппаратная виртуализация - гипервизор сам является по сути операционной системой, то есть дополнительно хостовая ОС не требуется. Это полная виртуализация. Гостевая ОС передает напрямую аппаратной части инструкции, которые должны поддерживаться этой аппаратной чстью. 

Виртуализация на основе ОС - гостевая ОС не знает, что она находится в виртуальной среде. Аппаратное обеспечение виртуализируется хостовой ОС, то есть аппаратное обеспечение имитируется. Такой тип виртуализации использует контейнеры. Их суть в том, что несклько контейнеров используют ресурсы одной и той же хостовой ОС, при этом ресурсы изолированы для каждого контейнера.



Задача 2
Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:

физические сервера,
паравиртуализация,
виртуализация уровня ОС.
Условия использования:

Высоконагруженная база данных, чувствительная к отказу.
Различные web-приложения.
Windows системы для использования бухгалтерским отделом.
Системы, выполняющие высокопроизводительные расчеты на GPU.
Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

Ответ:
физические сервера - Системы, выполняющие высокопроизводительные расчеты на GPU, высоконагруженная база данных, чувствительная к отказу. Так как у приложений есть прямой доступ к аппаратным ресурсам, на виртуализацию ресурсы не тратятся. Кроме того отсутствуют дополительные точки отказа в виде гипервизора. Более отказоустойчивым решением тут будет использование полной аппаратной виртуализации и объединение серверов в кластер.

паравиртуализация - Windows системы для использования бухгалтерским отделом. Если используется гипервизор от Microsoft, то особенно актуально. В данном случае присутствует гибкость с точки зрения масштабирования, ресурсы для каждой VM определяются заранее, удобно администрировать парк виртуальных машин, которые изолированы друг от друга.  

виртуализация уровня ОС. - Различные web-приложения. Контейнеры дают гибкость при масштабировании и высокий уровень отказоустойчивости. Предполагается, что web приложения требуют меньше ресурсов, чем, например, высокопроизводительные рассчеты на GPU. Также использование контейнеров удобнее с точки зрения администрирования.



Задача 3
Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
Для такого сценария, на мой взгляд, лучше всего подходит решение от VmWare vSphere, так как данное решение обладает богатым функционалом с точки зрения резервирования и балансировки нагрузки. 

Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
KVM - open source решение, поддерживает и Linux и Windows, хорошая производительность.

Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
Hyper-V - является бесплатным гипервизором от Microsoft, также встроен в некоторые ОС от Microsoft, поэтому для сценария с использованием Windows машин подходит лучше всего.

Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.
Xen - поддерживает разные дистрибутивы linux. Позволяет создавать шаблоны и быстро запускать виртуальные машины linux. Xen обладает хорошей стабильностью и производительностью.

Задача 4
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Гетерогенная среда виртуализации предполагает повышенные требования к компетенции инженеров, более сложное обслуживание, проблемы с автоматизацией, риски связанные с совместимостью и, поскольку отсутствует общий стандарт, низкая эффективность. Гетерогенная среда виртуализации должна использоваться в исключительнах случаях, например, когда есть привязка к определенному вендору для определенного сервиса. Также минусом гетерогенной виртуализации является более дорогая техническая поддержка.

Минимизацией рисков при ипользовании гетерогенной среды виртуализации является грамотное планирование и проектирование. Необходимо понимать в какую сторону раззвивается инфраструктура, чтобы не загнать себя в угол и оказаться в сложной ситуации из-за несовместимости продуктов или сервисов. Правильнее, на мой взгляд, как минимум разделять среды виртуализации  и сервисы на низх по какому-либо принципу, чтобы они не интегрировались между собой в значительной степени.

Плюс гетерогенной среды виртуализации может быть в отвязке от какого-то одного вендора, а также в увеличении производительности для определенных сервисов оптимизированных под определенную среду виртуализации. Например, VmWare может не поддерживать некоторые виды аппаратного обеспечения, поэтому вместе с VmWare можно использовать альтернативную среду виртуализации. Другой пример, когда есть парк VM под Windows и под Lunux, то можно использовать hyper-v для Windows систем, а для linux Xen или KVM, если это дает ощутимый прирост производительности и функцональности и упрощает администрирование.

Я бы не стал использовать гетерогенную среду виртуализации без особой необходимости.




